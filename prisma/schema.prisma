// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String      @id @default(cuid())
  name          String
  email         String      @unique
  mockPassword  String      // Mock password for demo purposes
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  // Relations
  sentDocuments     Document[] @relation("SentDocuments")
  receivedDocuments Document[] @relation("ReceivedDocuments")
  eventLogs         EventLog[]
}

model Document {
  id           String    @id @default(cuid())
  title        String
  status       String    @default("PENDING") // PENDING, SIGNED, COMPLETED
  requestedAt  DateTime  @default(now())
  signedAt     DateTime?
  
  // File storage
  fileData     String?   // Base64 encoded file content
  fileName     String?
  fileType     String?   // MIME type

  signature           String?
  initials            String?
  signaturePositionX  Int?
  signaturePositionY  Int?
  
  // Foreign Keys
  senderId     String
  recipientId  String
  
  // Relations
  sender       User      @relation("SentDocuments", fields: [senderId], references: [id])
  recipient    User      @relation("ReceivedDocuments", fields: [recipientId], references: [id])
  eventLogs    EventLog[]
  
  @@index([senderId])
  @@index([recipientId])
  @@index([status])
}

model EventLog {
  id          String   @id @default(cuid())
  actionType  String   // LOGIN, DOCUMENT_REQUESTED, SIGN_ACTION, DASHBOARD_VIEW, CUSTOM
  userId      String?
  documentId  String?
  payload     String   // JSON string of additional data
  timestamp   DateTime @default(now())
  
  // Relations
  user        User?     @relation(fields: [userId], references: [id])
  document    Document? @relation(fields: [documentId], references: [id])
  
  @@index([actionType])
  @@index([userId])
  @@index([timestamp])
}
